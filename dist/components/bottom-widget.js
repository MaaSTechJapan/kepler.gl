"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = BottomWidgetFactory;

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireDefault(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _timeWidget = _interopRequireDefault(require("./filters/time-widget"));

var _animationControl = _interopRequireDefault(require("./common/animation-control/animation-control"));

var _defaultSettings = require("../constants/default-settings");

function _templateObject() {
  var data = (0, _taggedTemplateLiteral2["default"])(["\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  padding-top: ", "px;\n  padding-right: ", "px;\n  padding-bottom: ", "px;\n  padding-left: ", "px;\n  width: ", "px;\n  bottom: 0;\n  right: 0;\n  z-index: 1;\n"]);

  _templateObject = function _templateObject() {
    return data;
  };

  return data;
}

var propTypes = {
  filters: _propTypes["default"].arrayOf(_propTypes["default"].object),
  datasets: _propTypes["default"].object,
  uiState: _propTypes["default"].object,
  layers: _propTypes["default"].arrayOf(_propTypes["default"].object),
  animationConfig: _propTypes["default"].object,
  visStateActions: _propTypes["default"].object,
  sidePanelWidth: _propTypes["default"].number,
  containerW: _propTypes["default"].number
};
var maxWidth = 1080;
BottomWidgetFactory.deps = [_timeWidget["default"], _animationControl["default"]];

var BottomWidgetContainer = _styledComponents["default"].div(_templateObject(), function (props) {
  return props.theme.sidePanel.margin.top;
}, function (props) {
  return props.theme.sidePanel.margin.right;
}, function (props) {
  return props.theme.sidePanel.margin.bottom;
}, function (props) {
  return props.theme.sidePanel.margin.left;
}, function (props) {
  return props.width;
});

function BottomWidgetFactory(TimeWidget, AnimationControl) {
  var BottomWidget = function BottomWidget(props) {
    var datasets = props.datasets,
        filters = props.filters,
        animationConfig = props.animationConfig,
        visStateActions = props.visStateActions,
        containerW = props.containerW,
        uiState = props.uiState,
        sidePanelWidth = props.sidePanelWidth,
        layers = props.layers;
    var activeSidePanel = uiState.activeSidePanel,
        readOnly = uiState.readOnly;
    var isOpen = Boolean(activeSidePanel);
    var enlargedFilterIdx = filters.findIndex(function (f) {
      return f.enlarged && f.type === _defaultSettings.FILTER_TYPES.timeRange;
    });
    var isAnyFilterAnimating = filters.some(function (f) {
      return f.isAnimating;
    });
    var enlargedFilterWidth = isOpen ? containerW - sidePanelWidth : containerW; // show playback control if layers contain trip layer & at least one trip layer is visible

    var animatedLayer = layers.filter(function (l) {
      return l.config.animation && l.config.animation.enabled && l.config.isVisible;
    });
    var readToAnimation = Array.isArray(animationConfig.domain) && animationConfig.currentTime; // if animation control is showing, hide time display in time slider

    var showFloatingTimeDisplay = !animatedLayer.length;
    return /*#__PURE__*/_react["default"].createElement(BottomWidgetContainer, {
      width: Math.min(maxWidth, enlargedFilterWidth),
      className: "bottom-widget--container"
    }, animatedLayer.length && readToAnimation ? /*#__PURE__*/_react["default"].createElement(AnimationControl, {
      animationConfig: animationConfig,
      updateAnimationTime: visStateActions.updateAnimationTime,
      updateAnimationSpeed: visStateActions.updateLayerAnimationSpeed
    }) : null, enlargedFilterIdx > -1 && Object.keys(datasets).length > 0 ? /*#__PURE__*/_react["default"].createElement(TimeWidget, {
      filter: filters[enlargedFilterIdx],
      index: enlargedFilterIdx,
      isAnyFilterAnimating: isAnyFilterAnimating,
      datasets: datasets,
      readOnly: readOnly,
      showTimeDisplay: showFloatingTimeDisplay,
      setFilterPlot: visStateActions.setFilterPlot,
      setFilter: visStateActions.setFilter,
      toggleAnimation: visStateActions.toggleFilterAnimation,
      updateAnimationSpeed: visStateActions.updateFilterAnimationSpeed,
      enlargeFilter: visStateActions.enlargeFilter
    }) : null);
  };

  BottomWidget.propTypes = propTypes;
  return BottomWidget;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL2JvdHRvbS13aWRnZXQuanMiXSwibmFtZXMiOlsicHJvcFR5cGVzIiwiZmlsdGVycyIsIlByb3BUeXBlcyIsImFycmF5T2YiLCJvYmplY3QiLCJkYXRhc2V0cyIsInVpU3RhdGUiLCJsYXllcnMiLCJhbmltYXRpb25Db25maWciLCJ2aXNTdGF0ZUFjdGlvbnMiLCJzaWRlUGFuZWxXaWR0aCIsIm51bWJlciIsImNvbnRhaW5lclciLCJtYXhXaWR0aCIsIkJvdHRvbVdpZGdldEZhY3RvcnkiLCJkZXBzIiwiVGltZVdpZGdldEZhY3RvcnkiLCJBbmltYXRpb25Db250cm9sRmFjdG9yeSIsIkJvdHRvbVdpZGdldENvbnRhaW5lciIsInN0eWxlZCIsImRpdiIsInByb3BzIiwidGhlbWUiLCJzaWRlUGFuZWwiLCJtYXJnaW4iLCJ0b3AiLCJyaWdodCIsImJvdHRvbSIsImxlZnQiLCJ3aWR0aCIsIlRpbWVXaWRnZXQiLCJBbmltYXRpb25Db250cm9sIiwiQm90dG9tV2lkZ2V0IiwiYWN0aXZlU2lkZVBhbmVsIiwicmVhZE9ubHkiLCJpc09wZW4iLCJCb29sZWFuIiwiZW5sYXJnZWRGaWx0ZXJJZHgiLCJmaW5kSW5kZXgiLCJmIiwiZW5sYXJnZWQiLCJ0eXBlIiwiRklMVEVSX1RZUEVTIiwidGltZVJhbmdlIiwiaXNBbnlGaWx0ZXJBbmltYXRpbmciLCJzb21lIiwiaXNBbmltYXRpbmciLCJlbmxhcmdlZEZpbHRlcldpZHRoIiwiYW5pbWF0ZWRMYXllciIsImZpbHRlciIsImwiLCJjb25maWciLCJhbmltYXRpb24iLCJlbmFibGVkIiwiaXNWaXNpYmxlIiwicmVhZFRvQW5pbWF0aW9uIiwiQXJyYXkiLCJpc0FycmF5IiwiZG9tYWluIiwiY3VycmVudFRpbWUiLCJzaG93RmxvYXRpbmdUaW1lRGlzcGxheSIsImxlbmd0aCIsIk1hdGgiLCJtaW4iLCJ1cGRhdGVBbmltYXRpb25UaW1lIiwidXBkYXRlTGF5ZXJBbmltYXRpb25TcGVlZCIsIk9iamVjdCIsImtleXMiLCJzZXRGaWx0ZXJQbG90Iiwic2V0RmlsdGVyIiwidG9nZ2xlRmlsdGVyQW5pbWF0aW9uIiwidXBkYXRlRmlsdGVyQW5pbWF0aW9uU3BlZWQiLCJlbmxhcmdlRmlsdGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQW9CQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsU0FBUyxHQUFHO0FBQ2hCQyxFQUFBQSxPQUFPLEVBQUVDLHNCQUFVQyxPQUFWLENBQWtCRCxzQkFBVUUsTUFBNUIsQ0FETztBQUVoQkMsRUFBQUEsUUFBUSxFQUFFSCxzQkFBVUUsTUFGSjtBQUdoQkUsRUFBQUEsT0FBTyxFQUFFSixzQkFBVUUsTUFISDtBQUloQkcsRUFBQUEsTUFBTSxFQUFFTCxzQkFBVUMsT0FBVixDQUFrQkQsc0JBQVVFLE1BQTVCLENBSlE7QUFLaEJJLEVBQUFBLGVBQWUsRUFBRU4sc0JBQVVFLE1BTFg7QUFNaEJLLEVBQUFBLGVBQWUsRUFBRVAsc0JBQVVFLE1BTlg7QUFPaEJNLEVBQUFBLGNBQWMsRUFBRVIsc0JBQVVTLE1BUFY7QUFRaEJDLEVBQUFBLFVBQVUsRUFBRVYsc0JBQVVTO0FBUk4sQ0FBbEI7QUFXQSxJQUFNRSxRQUFRLEdBQUcsSUFBakI7QUFFQUMsbUJBQW1CLENBQUNDLElBQXBCLEdBQTJCLENBQUNDLHNCQUFELEVBQW9CQyw0QkFBcEIsQ0FBM0I7O0FBRUEsSUFBTUMscUJBQXFCLEdBQUdDLDZCQUFPQyxHQUFWLG9CQUlWLFVBQUFDLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUMsU0FBWixDQUFzQkMsTUFBdEIsQ0FBNkJDLEdBQWpDO0FBQUEsQ0FKSyxFQUtSLFVBQUFKLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUMsU0FBWixDQUFzQkMsTUFBdEIsQ0FBNkJFLEtBQWpDO0FBQUEsQ0FMRyxFQU1QLFVBQUFMLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtB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QUFDQyxJQUFQLENBQVk5RCxRQUFaLEVBQXNCd0QsTUFBdEIsR0FBK0IsQ0FBekQsZ0JBQ0MsZ0NBQUMsVUFBRDtBQUNFLE1BQUEsTUFBTSxFQUFFNUQsT0FBTyxDQUFDb0MsaUJBQUQsQ0FEakI7QUFFRSxNQUFBLEtBQUssRUFBRUEsaUJBRlQ7QUFHRSxNQUFBLG9CQUFvQixFQUFFTyxvQkFIeEI7QUFJRSxNQUFBLFFBQVEsRUFBRXZDLFFBSlo7QUFLRSxNQUFBLFFBQVEsRUFBRTZCLFFBTFo7QUFNRSxNQUFBLGVBQWUsRUFBRTBCLHVCQU5uQjtBQU9FLE1BQUEsYUFBYSxFQUFFbkQsZUFBZSxDQUFDMkQsYUFQakM7QUFRRSxNQUFBLFNBQVMsRUFBRTNELGVBQWUsQ0FBQzRELFNBUjdCO0FBU0UsTUFBQSxlQUFlLEVBQUU1RCxlQUFlLENBQUM2RCxxQkFUbkM7QUFVRSxNQUFBLG9CQUFvQixFQUFFN0QsZUFBZSxDQUFDOEQsMEJBVnhDO0FBV0UsTUFBQSxhQUFhLEVBQUU5RCxlQUFlLENBQUMrRDtBQVhqQyxNQURELEdBY0csSUF6Qk4sQ0FERjtBQTZCRCxHQTFERDs7QUE0REF4QyxFQUFBQSxZQUFZLENBQUNoQyxTQUFiLEdBQXlCQSxTQUF6QjtBQUVBLFNBQU9nQyxZQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMjAgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4vLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4vLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4vLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4vLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcclxuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcclxuaW1wb3J0IFRpbWVXaWRnZXRGYWN0b3J5IGZyb20gJy4vZmlsdGVycy90aW1lLXdpZGdldCc7XHJcbmltcG9ydCBBbmltYXRpb25Db250cm9sRmFjdG9yeSBmcm9tICcuL2NvbW1vbi9hbmltYXRpb24tY29udHJvbC9hbmltYXRpb24tY29udHJvbCc7XHJcbmltcG9ydCB7RklMVEVSX1RZUEVTfSBmcm9tICdjb25zdGFudHMvZGVmYXVsdC1zZXR0aW5ncyc7XHJcblxyXG5jb25zdCBwcm9wVHlwZXMgPSB7XHJcbiAgZmlsdGVyczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLm9iamVjdCksXHJcbiAgZGF0YXNldHM6IFByb3BUeXBlcy5vYmplY3QsXHJcbiAgdWlTdGF0ZTogUHJvcFR5cGVzLm9iamVjdCxcclxuICBsYXllcnM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5vYmplY3QpLFxyXG4gIGFuaW1hdGlvbkNvbmZpZzogUHJvcFR5cGVzLm9iamVjdCxcclxuICB2aXNTdGF0ZUFjdGlvbnM6IFByb3BUeXBlcy5vYmplY3QsXHJcbiAgc2lkZVBhbmVsV2lkdGg6IFByb3BUeXBlcy5udW1iZXIsXHJcbiAgY29udGFpbmVyVzogUHJvcFR5cGVzLm51bWJlclxyXG59O1xyXG5cclxuY29uc3QgbWF4V2lkdGggPSAxMDgwO1xyXG5cclxuQm90dG9tV2lkZ2V0RmFjdG9yeS5kZXBzID0gW1RpbWVXaWRnZXRGYWN0b3J5LCBBbmltYXRpb25Db250cm9sRmFjdG9yeV07XHJcblxyXG5jb25zdCBCb3R0b21XaWRnZXRDb250YWluZXIgPSBzdHlsZWQuZGl2YFxyXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICBkaXNwbGF5OiBmbGV4O1xyXG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XHJcbiAgcGFkZGluZy10b3A6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuc2lkZVBhbmVsLm1hcmdpbi50b3B9cHg7XHJcbiAgcGFkZGluZy1yaWdodDogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5zaWRlUGFuZWwubWFyZ2luLnJpZ2h0fXB4O1xyXG4gIHBhZGRpbmctYm90dG9tOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnNpZGVQYW5lbC5tYXJnaW4uYm90dG9tfXB4O1xyXG4gIHBhZGRpbmctbGVmdDogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5zaWRlUGFuZWwubWFyZ2luLmxlZnR9cHg7XHJcbiAgd2lkdGg6ICR7cHJvcHMgPT4gcHJvcHMud2lkdGh9cHg7XHJcbiAgYm90dG9tOiAwO1xyXG4gIHJpZ2h0OiAwO1xyXG4gIHotaW5kZXg6IDE7XHJcbmA7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBCb3R0b21XaWRnZXRGYWN0b3J5KFRpbWVXaWRnZXQsIEFuaW1hdGlvbkNvbnRyb2wpIHtcclxuICBjb25zdCBCb3R0b21XaWRnZXQgPSBwcm9wcyA9PiB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIGRhdGFzZXRzLFxyXG4gICAgICBmaWx0ZXJzLFxyXG4gICAgICBhbmltYXRpb25Db25maWcsXHJcbiAgICAgIHZpc1N0YXRlQWN0aW9ucyxcclxuICAgICAgY29udGFpbmVyVyxcclxuICAgICAgdWlTdGF0ZSxcclxuICAgICAgc2lkZVBhbmVsV2lkdGgsXHJcbiAgICAgIGxheWVyc1xyXG4gICAgfSA9IHByb3BzO1xyXG5cclxuICAgIGNvbnN0IHthY3RpdmVTaWRlUGFuZWwsIHJlYWRPbmx5fSA9IHVpU3RhdGU7XHJcbiAgICBjb25zdCBpc09wZW4gPSBCb29sZWFuKGFjdGl2ZVNpZGVQYW5lbCk7XHJcblxyXG4gICAgY29uc3QgZW5sYXJnZWRGaWx0ZXJJZHggPSBmaWx0ZXJzLmZpbmRJbmRleChcclxuICAgICAgZiA9PiBmLmVubGFyZ2VkICYmIGYudHlwZSA9PT0gRklMVEVSX1RZUEVTLnRpbWVSYW5nZVxyXG4gICAgKTtcclxuICAgIGNvbnN0IGlzQW55RmlsdGVyQW5pbWF0aW5nID0gZmlsdGVycy5zb21lKGYgPT4gZi5pc0FuaW1hdGluZyk7XHJcbiAgICBjb25zdCBlbmxhcmdlZEZpbHRlcldpZHRoID0gaXNPcGVuID8gY29udGFpbmVyVyAtIHNpZGVQYW5lbFdpZHRoIDogY29udGFpbmVyVztcclxuXHJcbiAgICAvLyBzaG93IHBsYXliYWNrIGNvbnRyb2wgaWYgbGF5ZXJzIGNvbnRhaW4gdHJpcCBsYXllciAmIGF0IGxlYXN0IG9uZSB0cmlwIGxheWVyIGlzIHZpc2libGVcclxuICAgIGNvbnN0IGFuaW1hdGVkTGF5ZXIgPSBsYXllcnMuZmlsdGVyKFxyXG4gICAgICBsID0+IGwuY29uZmlnLmFuaW1hdGlvbiAmJiBsLmNvbmZpZy5hbmltYXRpb24uZW5hYmxlZCAmJiBsLmNvbmZpZy5pc1Zpc2libGVcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgcmVhZFRvQW5pbWF0aW9uID0gQXJyYXkuaXNBcnJheShhbmltYXRpb25Db25maWcuZG9tYWluKSAmJiBhbmltYXRpb25Db25maWcuY3VycmVudFRpbWU7XHJcbiAgICAvLyBpZiBhbmltYXRpb24gY29udHJvbCBpcyBzaG93aW5nLCBoaWRlIHRpbWUgZGlzcGxheSBpbiB0aW1lIHNsaWRlclxyXG4gICAgY29uc3Qgc2hvd0Zsb2F0aW5nVGltZURpc3BsYXkgPSAhYW5pbWF0ZWRMYXllci5sZW5ndGg7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8Qm90dG9tV2lkZ2V0Q29udGFpbmVyXHJcbiAgICAgICAgd2lkdGg9e01hdGgubWluKG1heFdpZHRoLCBlbmxhcmdlZEZpbHRlcldpZHRoKX1cclxuICAgICAgICBjbGFzc05hbWU9XCJib3R0b20td2lkZ2V0LS1jb250YWluZXJcIlxyXG4gICAgICA+XHJcbiAgICAgICAge2FuaW1hdGVkTGF5ZXIubGVuZ3RoICYmIHJlYWRUb0FuaW1hdGlvbiA/IChcclxuICAgICAgICAgIDxBbmltYXRpb25Db250cm9sXHJcbiAgICAgICAgICAgIGFuaW1hdGlvbkNvbmZpZz17YW5pbWF0aW9uQ29uZmlnfVxyXG4gICAgICAgICAgICB1cGRhdGVBbmltYXRpb25UaW1lPXt2aXNTdGF0ZUFjdGlvbnMudXBkYXRlQW5pbWF0aW9uVGltZX1cclxuICAgICAgICAgICAgdXBkYXRlQW5pbWF0aW9uU3BlZWQ9e3Zpc1N0YXRlQWN0aW9ucy51cGRhdGVMYXllckFuaW1hdGlvblNwZWVkfVxyXG4gICAgICAgICAgLz5cclxuICAgICAgICApIDogbnVsbH1cclxuICAgICAgICB7ZW5sYXJnZWRGaWx0ZXJJZHggPiAtMSAmJiBPYmplY3Qua2V5cyhkYXRhc2V0cykubGVuZ3RoID4gMCA/IChcclxuICAgICAgICAgIDxUaW1lV2lkZ2V0XHJcbiAgICAgICAgICAgIGZpbHRlcj17ZmlsdGVyc1tlbmxhcmdlZEZpbHRlcklkeF19XHJcbiAgICAgICAgICAgIGluZGV4PXtlbmxhcmdlZEZpbHRlcklkeH1cclxuICAgICAgICAgICAgaXNBbnlGaWx0ZXJBbmltYXRpbmc9e2lzQW55RmlsdGVyQW5pbWF0aW5nfVxyXG4gICAgICAgICAgICBkYXRhc2V0cz17ZGF0YXNldHN9XHJcbiAgICAgICAgICAgIHJlYWRPbmx5PXtyZWFkT25seX1cclxuICAgICAgICAgICAgc2hvd1RpbWVEaXNwbGF5PXtzaG93RmxvYXRpbmdUaW1lRGlzcGxheX1cclxuICAgICAgICAgICAgc2V0RmlsdGVyUGxvdD17dmlzU3RhdGVBY3Rpb25zLnNldEZpbHRlclBsb3R9XHJcbiAgICAgICAgICAgIHNldEZpbHRlcj17dmlzU3RhdGVBY3Rpb25zLnNldEZpbHRlcn1cclxuICAgICAgICAgICAgdG9nZ2xlQW5pbWF0aW9uPXt2aXNTdGF0ZUFjdGlvbnMudG9nZ2xlRmlsdGVyQW5pbWF0aW9ufVxyXG4gICAgICAgICAgICB1cGRhdGVBbmltYXRpb25TcGVlZD17dmlzU3RhdGVBY3Rpb25zLnVwZGF0ZUZpbHRlckFuaW1hdGlvblNwZWVkfVxyXG4gICAgICAgICAgICBlbmxhcmdlRmlsdGVyPXt2aXNTdGF0ZUFjdGlvbnMuZW5sYXJnZUZpbHRlcn1cclxuICAgICAgICAgIC8+XHJcbiAgICAgICAgKSA6IG51bGx9XHJcbiAgICAgIDwvQm90dG9tV2lkZ2V0Q29udGFpbmVyPlxyXG4gICAgKTtcclxuICB9O1xyXG5cclxuICBCb3R0b21XaWRnZXQucHJvcFR5cGVzID0gcHJvcFR5cGVzO1xyXG5cclxuICByZXR1cm4gQm90dG9tV2lkZ2V0O1xyXG59XHJcbiJdfQ==